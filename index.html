<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="fengari-web.js" type="text/javascript"></script>
    <script type="application/lua">
        local testlib = {}

local tests = 0
local failed = 0
local passed = 0

function log(info)
    print("[info]: "..info)
end

function log_error(error)
    print("--> [error]: "..error)
end

function init() 
    tests = 0
    failed = 0
    passed = 0
    print("")
    print("")
    print("-----Test starts-----")
end

function title(text)
    print("test: "..text)
    return
end

function isArray(any) 
    if type(any) == "number" then return false end
    return #any ~= nil and any[1] ~= nil
end

function convertAnyToString(any)
    if any == nil then return "/nil" end
    if any == true then return "bool/true" end
    if any == false then return "bool/false" end

    if isArray(any) then 
        local str = ""
        for i=1, #any do 
            str = str..any[i]..","
        end
        return str
    end
    return ""..any
end

function deep_equals(a, b) 
    local result = true
    if #a ~= #b then 
        result = false
    else
        for i=1,#a do
            if a[i] ~= b[i] then 
                result = false
                break
            end
        end
    end
    return result
end

function assert_equal(a, b, description)
    if description == nil then description = "unset description" end
    tests = tests + 1
    
    local test_failed = false
    
    if a ~= b then
        if isArray(a) and isArray(b) then 
            test_failed = not deep_equals(a,b)
        else 
            test_failed = true
        end
    end

    if test_failed then 
        failed = failed + 1
        log_error(description.." failed -> "..convertAnyToString(a).." != "..convertAnyToString(b))
    else 
        passed = passed + 1
    end
end

function result()
    
    if failed > 0 then log_error(""..failed.."/"..passed.." tests failed!") else 
        log("test succeded: "..passed.."/"..tests.." passed")
    end
end

init()

--functions to test:
function sort(a)
	local temp = {}	
	for i=1,#a do
		temp[i] = a[i]
	end
    for i=1,#temp do
        local j = i
        while j > 1 and temp[j-1] > temp[j] do
            temp[j],temp[j-1] = temp[j-1],temp[j]
            j = j - 1
        end
    end
	return temp;
end

--functions tests:

assert_equal(sort({4,3,2,1}),{1,2,3,3},"test sort")

result()
    </script>    
    <script src="/my-script.lua" type="application/lua" async></script>    
    
</head>
<body>
    <script type="text/javascript">
        console.log(window.test_suite);
    </script>
</body>
</html>